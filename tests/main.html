<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆä¸»æµ‹è¯•é¡µé¢</title>
    <!-- Vue.js 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            font-family: 'JetBrains Mono', monospace;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0d1117;
            color: #f0f6fc;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #21262d;
            border-radius: 8px;
            border: 1px solid #30363d;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #1a472a; color: #4caf50; }
        .error { background: #4a1a1a; color: #f44336; }
        .info { background: #1a2a4a; color: #2196f3; }
        .warning { background: #4a3a1a; color: #ff9800; }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
        pre { background: #161b22; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ® é”®ç›˜æ‰“å­—ç«é€Ÿæ¸¸æˆ - æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>ğŸ“¡ API æµ‹è¯•</h2>
        <button onclick="testAPI()">æµ‹è¯• API è¿æ¥</button>
        <div id="apiResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸµ éŸ³é¢‘æµ‹è¯•</h2>
        <button onclick="testAudio()">æµ‹è¯•éŸ³é¢‘ç³»ç»Ÿ</button>
        <div id="audioResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ’¾ å­˜å‚¨æµ‹è¯•</h2>
        <button onclick="testStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
        <div id="storageResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ® æ¸¸æˆåŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="testGameFeatures()">æµ‹è¯•æ¸¸æˆåŠŸèƒ½</button>
        <div id="gameResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ”— å¿«é€Ÿé“¾æ¥</h2>
        <button onclick="window.location.href='../index.html'">è¿”å›ä¸»æ¸¸æˆ</button>
        <button onclick="window.location.href='../docs'">æŸ¥çœ‹APIæ–‡æ¡£</button>
        <button onclick="window.location.href='test_defense_mode.html'">æ¤ç‰©é˜²å¾¡æµ‹è¯•</button>
    </div>

    <script>
        // æµ‹è¯•ç»“æœæ˜¾ç¤ºå‡½æ•°
        function showResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = message;
            container.appendChild(resultDiv);
        }
        
        function clearResults(containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = '';
            }
        }
        
        // API æµ‹è¯•
        async function testAPI() {
            clearResults('apiResults');
            showResult('apiResults', 'ğŸ”„ æµ‹è¯• API è¿æ¥...', 'info');
            
            try {
                // æµ‹è¯•æ–‡æœ¬API
                const textsResponse = await fetch('/api/texts');
                if (textsResponse.ok) {
                    const textsData = await textsResponse.json();
                    showResult('apiResults', `âœ… æ–‡æœ¬APIæ­£å¸¸ - åŠ è½½äº† ${textsData.data.length} ä¸ªæ–‡æœ¬`, 'success');
                } else {
                    showResult('apiResults', 'âŒ æ–‡æœ¬APIå¤±è´¥', 'error');
                }
                
                // æµ‹è¯•å•è¯API
                const wordsResponse = await fetch('/api/words');
                if (wordsResponse.ok) {
                    const wordsData = await wordsResponse.json();
                    showResult('apiResults', `âœ… å•è¯APIæ­£å¸¸ - åŠ è½½äº† ${wordsData.data.length} ä¸ªå•è¯`, 'success');
                } else {
                    showResult('apiResults', 'âŒ å•è¯APIå¤±è´¥', 'error');
                }
                
                // æµ‹è¯•æ¤ç‰©é˜²å¾¡API
                const defenseResponse = await fetch('/api/defense/words');
                if (defenseResponse.ok) {
                    const defenseData = await defenseResponse.json();
                    const totalWords = Object.values(defenseData.data).reduce((sum, arr) => sum + arr.length, 0);
                    showResult('apiResults', `âœ… æ¤ç‰©é˜²å¾¡APIæ­£å¸¸ - åŠ è½½äº† ${totalWords} ä¸ªé˜²å¾¡å•è¯`, 'success');
                } else {
                    showResult('apiResults', 'âŒ æ¤ç‰©é˜²å¾¡APIå¤±è´¥', 'error');
                }
                
                // æµ‹è¯•ç»Ÿè®¡API
                const statsResponse = await fetch('/api/stats');
                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    showResult('apiResults', `âœ… ç»Ÿè®¡APIæ­£å¸¸ - å†å²è®°å½•: ${statsData.data.length} æ¡`, 'success');
                } else {
                    showResult('apiResults', 'âŒ ç»Ÿè®¡APIå¤±è´¥', 'error');
                }
                
            } catch (error) {
                showResult('apiResults', `âŒ APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // éŸ³é¢‘æµ‹è¯•
        async function testAudio() {
            clearResults('audioResults');
            showResult('audioResults', 'ğŸ”„ æµ‹è¯•éŸ³é¢‘ç³»ç»Ÿ...', 'info');
            
            try {
                // æ£€æŸ¥Web Audio APIæ”¯æŒ
                if (window.AudioContext || window.webkitAudioContext) {
                    showResult('audioResults', 'âœ… Web Audio API æ”¯æŒ', 'success');

                    // æ£€æŸ¥éŸ³é¢‘ä¸Šä¸‹æ–‡æ”¯æŒ
                    if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                        showResult('audioResults', 'âœ… æµè§ˆå™¨æ”¯æŒWeb Audio API', 'success');
                    } else {
                        showResult('audioResults', 'âŒ æµè§ˆå™¨ä¸æ”¯æŒWeb Audio API', 'error');
                    }

                    // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    showResult('audioResults', `âœ… éŸ³é¢‘ä¸Šä¸‹æ–‡åˆ›å»ºæˆåŠŸ - çŠ¶æ€: ${audioContext.state}`, 'success');

                    // æµ‹è¯•éŸ³æ•ˆç”Ÿæˆ
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                    
                    showResult('audioResults', 'âœ… éŸ³æ•ˆæµ‹è¯•æˆåŠŸ - ä½ åº”è¯¥å¬åˆ°äº†ä¸€ä¸ªçŸ­éŸ³', 'success');
                    
                } else {
                    showResult('audioResults', 'âŒ Web Audio API ä¸æ”¯æŒ', 'error');
                }
                
            } catch (error) {
                showResult('audioResults', `âŒ éŸ³é¢‘æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // å­˜å‚¨æµ‹è¯•
        async function testStorage() {
            clearResults('storageResults');
            showResult('storageResults', 'ğŸ”„ æµ‹è¯•æœ¬åœ°å­˜å‚¨...', 'info');
            
            try {
                // æµ‹è¯•localStorage
                const testKey = 'test_storage_key';
                const testValue = { test: 'data', timestamp: Date.now() };
                
                localStorage.setItem(testKey, JSON.stringify(testValue));
                const retrieved = JSON.parse(localStorage.getItem(testKey));
                
                if (retrieved && retrieved.test === testValue.test) {
                    showResult('storageResults', 'âœ… localStorage è¯»å†™æ­£å¸¸', 'success');
                    localStorage.removeItem(testKey);
                } else {
                    showResult('storageResults', 'âŒ localStorage æ•°æ®ä¸åŒ¹é…', 'error');
                }
                
                // æµ‹è¯•sessionStorage
                sessionStorage.setItem(testKey, JSON.stringify(testValue));
                const sessionRetrieved = JSON.parse(sessionStorage.getItem(testKey));
                
                if (sessionRetrieved && sessionRetrieved.test === testValue.test) {
                    showResult('storageResults', 'âœ… sessionStorage è¯»å†™æ­£å¸¸', 'success');
                    sessionStorage.removeItem(testKey);
                } else {
                    showResult('storageResults', 'âŒ sessionStorage æ•°æ®ä¸åŒ¹é…', 'error');
                }
                
                // æµ‹è¯•å­˜å‚¨å®¹é‡
                if (navigator.storage && navigator.storage.estimate) {
                    const storageInfo = await navigator.storage.estimate();
                    const usedMB = (storageInfo.usage / 1024 / 1024).toFixed(2);
                    const quotaMB = (storageInfo.quota / 1024 / 1024).toFixed(2);
                    showResult('storageResults', `âœ… å­˜å‚¨ä¿¡æ¯ - å·²ä½¿ç”¨: ${usedMB}MB / é…é¢: ${quotaMB}MB`, 'success');
                } else {
                    showResult('storageResults', 'âš ï¸ å­˜å‚¨å®¹é‡ä¿¡æ¯ä¸å¯ç”¨', 'warning');
                }
                
            } catch (error) {
                showResult('storageResults', `âŒ å­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ¸¸æˆåŠŸèƒ½æµ‹è¯•
        async function testGameFeatures() {
            clearResults('gameResults');
            showResult('gameResults', 'ğŸ”„ æµ‹è¯•æ¸¸æˆåŠŸèƒ½...', 'info');
            
            try {
                // æµ‹è¯•Vue.jsåŠ è½½
                if (typeof Vue !== 'undefined') {
                    showResult('gameResults', `âœ… Vue.js å·²åŠ è½½ - ç‰ˆæœ¬: ${Vue.version}`, 'success');
                } else {
                    showResult('gameResults', 'âŒ Vue.js æœªåŠ è½½', 'error');
                }
                
                // æµ‹è¯•åŸºæœ¬JavaScriptåŠŸèƒ½
                if (typeof window !== 'undefined') {
                    showResult('gameResults', 'âœ… å…¨å±€windowå¯¹è±¡å¯ç”¨', 'success');
                } else {
                    showResult('gameResults', 'âŒ å…¨å±€windowå¯¹è±¡ä¸å¯ç”¨', 'error');
                }
                
                // æµ‹è¯•ES6åŠŸèƒ½
                try {
                    const testArrow = () => 'ES6 Arrow Functions';
                    const testTemplate = `ES6 Template Literals`;
                    const testDestructuring = { a: 1, b: 2 };
                    const { a, b } = testDestructuring;
                    
                    if (testArrow() && testTemplate && a === 1 && b === 2) {
                        showResult('gameResults', 'âœ… ES6åŠŸèƒ½æ”¯æŒæ­£å¸¸', 'success');
                    }
                } catch (es6Error) {
                    showResult('gameResults', 'âŒ ES6åŠŸèƒ½æ”¯æŒæœ‰é™', 'error');
                }
                
                // æµ‹è¯•å¼‚æ­¥åŠŸèƒ½
                try {
                    const testPromise = new Promise(resolve => resolve('Promiseæ”¯æŒ'));
                    const result = await testPromise;
                    if (result) {
                        showResult('gameResults', 'âœ… Promise/Asyncæ”¯æŒæ­£å¸¸', 'success');
                    }
                } catch (asyncError) {
                    showResult('gameResults', 'âŒ Promise/Asyncæ”¯æŒæœ‰é™', 'error');
                }

                // æµ‹è¯•å·¥å…·å‡½æ•°
                if (typeof Utils !== 'undefined') {
                    showResult('gameResults', 'âŒ Utils æœªåŠ è½½ - è¯·ç¡®ä¿åœ¨ä¸»é¡µé¢æµ‹è¯•', 'error');
                } else {
                    // æ¨¡æ‹Ÿå·¥å…·å‡½æ•°æµ‹è¯•
                    const testWPM = Math.round((100 / 5) / (60 / 60)); // 100å­—ç¬¦ï¼Œ60ç§’
                    showResult('gameResults', `âœ… WPMè®¡ç®—æµ‹è¯• - æ¨¡æ‹Ÿç»“æœ: ${testWPM} WPM`, 'success');
                    
                    const testAccuracy = Math.round((95 / 100) * 100);
                    showResult('gameResults', `âœ… å‡†ç¡®ç‡è®¡ç®—æµ‹è¯• - æ¨¡æ‹Ÿç»“æœ: ${testAccuracy}%`, 'success');
                }
                
                // æµ‹è¯•å®šæ—¶å™¨åŠŸèƒ½
                const startTime = Date.now();
                setTimeout(() => {
                    const elapsed = Date.now() - startTime;
                    if (elapsed >= 990 && elapsed <= 1100) {
                        showResult('gameResults', `âœ… å®šæ—¶å™¨åŠŸèƒ½æ­£å¸¸ - ç²¾åº¦: ${elapsed}ms`, 'success');
                    } else {
                        showResult('gameResults', `âš ï¸ å®šæ—¶å™¨ç²¾åº¦åå·® - å®é™…: ${elapsed}ms`, 'warning');
                    }
                }, 1000);
                
                // æµ‹è¯•requestAnimationFrame
                if (typeof requestAnimationFrame !== 'undefined') {
                    showResult('gameResults', 'âœ… requestAnimationFrame æ”¯æŒæ­£å¸¸', 'success');
                } else {
                    showResult('gameResults', 'âŒ requestAnimationFrame ä¸æ”¯æŒ', 'error');
                }

                // æµ‹è¯•é”®ç›˜äº‹ä»¶
                let keyTestPassed = false;
                const keyHandler = (e) => {
                    keyTestPassed = true;
                    showResult('gameResults', `âœ… é”®ç›˜äº‹ä»¶ç›‘å¬æ­£å¸¸ - æŒ‰é”®: ${e.key}`, 'success');
                    document.removeEventListener('keydown', keyHandler);
                };
                
                document.addEventListener('keydown', keyHandler);
                showResult('gameResults', 'âŒ¨ï¸ è¯·æŒ‰ä»»æ„é”®æµ‹è¯•é”®ç›˜äº‹ä»¶...', 'info');
                
                // 5ç§’åå¦‚æœæ²¡æœ‰æŒ‰é”®ï¼Œæ˜¾ç¤ºè¶…æ—¶
                setTimeout(() => {
                    if (!keyTestPassed) {
                        showResult('gameResults', 'âš ï¸ é”®ç›˜äº‹ä»¶æµ‹è¯•è¶…æ—¶ï¼ˆæœªæ£€æµ‹åˆ°æŒ‰é”®ï¼‰', 'warning');
                        document.removeEventListener('keydown', keyHandler);
                    }
                }, 5000);

            } catch (error) {
                showResult('gameResults', `âŒ æ¸¸æˆåŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('ğŸ§ª æµ‹è¯•é¡µé¢å·²åŠ è½½');
            
            // æ˜¾ç¤ºæµè§ˆå™¨ä¿¡æ¯
            const userAgent = navigator.userAgent;
            const browserInfo = {
                chrome: userAgent.includes('Chrome'),
                firefox: userAgent.includes('Firefox'),
                safari: userAgent.includes('Safari') && !userAgent.includes('Chrome'),
                edge: userAgent.includes('Edge')
            };
            
            console.log('ğŸŒ æµè§ˆå™¨ä¿¡æ¯:', browserInfo);
            
            setTimeout(() => {
                showResult('apiResults', 'ğŸ”„ è‡ªåŠ¨è¿è¡ŒAPIæµ‹è¯•...', 'info');
                testAPI();
            }, 1000);
        });
    </script>
</body>
</html>
