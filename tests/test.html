<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'JetBrains Mono', monospace;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0d1117;
            color: #f0f6fc;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #21262d;
            border-radius: 8px;
            border: 1px solid #30363d;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success { background: #1a472a; color: #4caf50; }
        .error { background: #4a1a1a; color: #f44336; }
        .info { background: #1a2a4a; color: #2196f3; }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
        pre { background: #161b22; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ® é”®ç›˜æ‰“å­—ç«é€Ÿæ¸¸æˆ - æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>ğŸ“¡ API æµ‹è¯•</h2>
        <button onclick="testAPI()">æµ‹è¯• API è¿æ¥</button>
        <div id="apiResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸµ éŸ³é¢‘æµ‹è¯•</h2>
        <button onclick="testAudio()">æµ‹è¯•éŸ³é¢‘ç³»ç»Ÿ</button>
        <div id="audioResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ’¾ å­˜å‚¨æµ‹è¯•</h2>
        <button onclick="testStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
        <div id="storageResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ¯ æ¸¸æˆåŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="testGameFeatures()">æµ‹è¯•æ¸¸æˆåŠŸèƒ½</button>
        <div id="gameResults"></div>
    </div>
    
    <div class="test-section">
        <h2>ğŸš€ å¯åŠ¨æ¸¸æˆ</h2>
        <p>å¦‚æœæ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡ï¼Œä½ å¯ä»¥å¯åŠ¨å®Œæ•´çš„æ¸¸æˆï¼š</p>
        <button onclick="window.location.href='index.html'">å¯åŠ¨æ¸¸æˆ</button>
    </div>

    <script>
        // æµ‹è¯•ç»“æœæ˜¾ç¤ºå‡½æ•°
        function showResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            container.appendChild(div);
        }
        
        // æ¸…é™¤æµ‹è¯•ç»“æœ
        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }
        
        // API æµ‹è¯•
        async function testAPI() {
            clearResults('apiResults');
            showResult('apiResults', 'ğŸ”„ æµ‹è¯• API è¿æ¥...', 'info');
            
            try {
                // æµ‹è¯•æ–‡æœ¬API
                const textsResponse = await fetch('/api/texts');
                if (textsResponse.ok) {
                    const textsData = await textsResponse.json();
                    showResult('apiResults', `âœ… æ–‡æœ¬APIæ­£å¸¸ - åŠ è½½äº† ${textsData.data.length} ä¸ªæ–‡æœ¬`, 'success');
                } else {
                    showResult('apiResults', 'âŒ æ–‡æœ¬APIå¤±è´¥', 'error');
                }
                
                // æµ‹è¯•å•è¯API
                const wordsResponse = await fetch('/api/words');
                if (wordsResponse.ok) {
                    const wordsData = await wordsResponse.json();
                    showResult('apiResults', `âœ… å•è¯APIæ­£å¸¸ - åŠ è½½äº† ${wordsData.data.length} ä¸ªå•è¯`, 'success');
                } else {
                    showResult('apiResults', 'âŒ å•è¯APIå¤±è´¥', 'error');
                }
                
                // æµ‹è¯•ç»Ÿè®¡API
                const statsResponse = await fetch('/api/stats');
                if (statsResponse.ok) {
                    showResult('apiResults', 'âœ… ç»Ÿè®¡APIæ­£å¸¸', 'success');
                } else {
                    showResult('apiResults', 'âŒ ç»Ÿè®¡APIå¤±è´¥', 'error');
                }
                
            } catch (error) {
                showResult('apiResults', `âŒ APIè¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // éŸ³é¢‘æµ‹è¯•
        function testAudio() {
            clearResults('audioResults');
            showResult('audioResults', 'ğŸ”„ æµ‹è¯•éŸ³é¢‘ç³»ç»Ÿ...', 'info');
            
            try {
                // æ£€æŸ¥Web Audio APIæ”¯æŒ
                if (window.AudioContext || window.webkitAudioContext) {
                    showResult('audioResults', 'âœ… Web Audio API æ”¯æŒ', 'success');
                    
                    // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    showResult('audioResults', `âœ… éŸ³é¢‘ä¸Šä¸‹æ–‡åˆ›å»ºæˆåŠŸ - çŠ¶æ€: ${audioContext.state}`, 'success');
                    
                    // æµ‹è¯•éŸ³æ•ˆç”Ÿæˆ
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                    
                    showResult('audioResults', 'âœ… éŸ³æ•ˆæµ‹è¯•æˆåŠŸ - ä½ åº”è¯¥å¬åˆ°äº†ä¸€ä¸ªçŸ­éŸ³', 'success');
                    
                } else {
                    showResult('audioResults', 'âŒ Web Audio API ä¸æ”¯æŒ', 'error');
                }
                
            } catch (error) {
                showResult('audioResults', `âŒ éŸ³é¢‘æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // å­˜å‚¨æµ‹è¯•
        function testStorage() {
            clearResults('storageResults');
            showResult('storageResults', 'ğŸ”„ æµ‹è¯•æœ¬åœ°å­˜å‚¨...', 'info');
            
            try {
                // æµ‹è¯•localStorage
                const testKey = 'test_key';
                const testValue = { test: 'data', timestamp: Date.now() };
                
                localStorage.setItem(testKey, JSON.stringify(testValue));
                const retrieved = JSON.parse(localStorage.getItem(testKey));
                
                if (retrieved && retrieved.test === testValue.test) {
                    showResult('storageResults', 'âœ… localStorage è¯»å†™æ­£å¸¸', 'success');
                    localStorage.removeItem(testKey);
                } else {
                    showResult('storageResults', 'âŒ localStorage æ•°æ®ä¸åŒ¹é…', 'error');
                }
                
                // æµ‹è¯•å­˜å‚¨å®¹é‡
                const storageInfo = navigator.storage && navigator.storage.estimate ? 
                    await navigator.storage.estimate() : null;
                
                if (storageInfo) {
                    const usedMB = (storageInfo.usage / 1024 / 1024).toFixed(2);
                    const quotaMB = (storageInfo.quota / 1024 / 1024).toFixed(2);
                    showResult('storageResults', `âœ… å­˜å‚¨ä¿¡æ¯ - å·²ä½¿ç”¨: ${usedMB}MB / é…é¢: ${quotaMB}MB`, 'success');
                }
                
            } catch (error) {
                showResult('storageResults', `âŒ å­˜å‚¨æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ¸¸æˆåŠŸèƒ½æµ‹è¯•
        function testGameFeatures() {
            clearResults('gameResults');
            showResult('gameResults', 'ğŸ”„ æµ‹è¯•æ¸¸æˆåŠŸèƒ½...', 'info');
            
            try {
                // æµ‹è¯•å·¥å…·å‡½æ•°
                if (typeof Utils !== 'undefined') {
                    showResult('gameResults', 'âŒ Utils æœªåŠ è½½ - è¯·ç¡®ä¿åœ¨ä¸»é¡µé¢æµ‹è¯•', 'error');
                } else {
                    // æ¨¡æ‹Ÿå·¥å…·å‡½æ•°æµ‹è¯•
                    const testWPM = Math.round((100 / 5) / (60 / 60)); // 100å­—ç¬¦ï¼Œ60ç§’
                    showResult('gameResults', `âœ… WPMè®¡ç®—æµ‹è¯• - æ¨¡æ‹Ÿç»“æœ: ${testWPM} WPM`, 'success');
                    
                    const testAccuracy = Math.round((95 / 100) * 100);
                    showResult('gameResults', `âœ… å‡†ç¡®ç‡è®¡ç®—æµ‹è¯• - æ¨¡æ‹Ÿç»“æœ: ${testAccuracy}%`, 'success');
                }
                
                // æµ‹è¯•é”®ç›˜äº‹ä»¶
                let keyTestPassed = false;
                const keyHandler = (e) => {
                    if (e.key === 'Enter') {
                        keyTestPassed = true;
                        showResult('gameResults', 'âœ… é”®ç›˜äº‹ä»¶æµ‹è¯•é€šè¿‡', 'success');
                        document.removeEventListener('keydown', keyHandler);
                    }
                };
                
                document.addEventListener('keydown', keyHandler);
                showResult('gameResults', 'âŒ¨ï¸ è¯·æŒ‰ Enter é”®æµ‹è¯•é”®ç›˜äº‹ä»¶...', 'info');
                
                // 5ç§’åç§»é™¤ç›‘å¬å™¨
                setTimeout(() => {
                    if (!keyTestPassed) {
                        document.removeEventListener('keydown', keyHandler);
                        showResult('gameResults', 'âš ï¸ é”®ç›˜äº‹ä»¶æµ‹è¯•è¶…æ—¶', 'error');
                    }
                }, 5000);
                
                // æµ‹è¯•DOMæ“ä½œ
                const testDiv = document.createElement('div');
                testDiv.textContent = 'DOMæµ‹è¯•';
                if (testDiv.textContent === 'DOMæµ‹è¯•') {
                    showResult('gameResults', 'âœ… DOMæ“ä½œæ­£å¸¸', 'success');
                }
                
            } catch (error) {
                showResult('gameResults', `âŒ æ¸¸æˆåŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                showResult('apiResults', 'ğŸ”„ è‡ªåŠ¨è¿è¡ŒAPIæµ‹è¯•...', 'info');
                testAPI();
            }, 1000);
        });
    </script>
</body>
</html>
