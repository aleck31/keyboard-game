<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘ä¿®å¤æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'JetBrains Mono', monospace;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #0d1117;
            color: #f0f6fc;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #21262d;
            border-radius: 8px;
            border: 1px solid #30363d;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
        button:disabled { background: #666; cursor: not-allowed; }
        .success { color: #4caf50; }
        .error { color: #f44336; }
        .info { color: #2196f3; }
        .warning { color: #ff9800; }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            background: #161b22;
            border: 1px solid #30363d;
        }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸµ éŸ³é¢‘ä¿®å¤æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>1. éŸ³é¢‘ç®¡ç†å™¨çŠ¶æ€æµ‹è¯•</h2>
        <div class="controls">
            <button onclick="checkAudioStatus()">æ£€æŸ¥éŸ³é¢‘çŠ¶æ€</button>
            <button onclick="toggleMainAudio()">åˆ‡æ¢ä¸»éŸ³é¢‘å¼€å…³</button>
            <button onclick="toggleMusic()">åˆ‡æ¢éŸ³ä¹å¼€å…³</button>
            <button onclick="toggleEffects()">åˆ‡æ¢éŸ³æ•ˆå¼€å…³</button>
        </div>
        <div id="audioStatus" class="status">ç‚¹å‡»"æ£€æŸ¥éŸ³é¢‘çŠ¶æ€"æŸ¥çœ‹å½“å‰çŠ¶æ€</div>
    </div>
    
    <div class="test-section">
        <h2>2. èƒŒæ™¯éŸ³ä¹æµ‹è¯•</h2>
        <div class="controls">
            <button onclick="startMusic()">å¼€å§‹éŸ³ä¹</button>
            <button onclick="stopMusic()">åœæ­¢éŸ³ä¹</button>
            <button onclick="testMusicTypes()">æµ‹è¯•ä¸åŒéŸ³ä¹ç±»å‹</button>
        </div>
        <div id="musicStatus" class="status">éŸ³ä¹çŠ¶æ€: æœªå¼€å§‹</div>
        <div class="info">
            â„¹ï¸ ç°åœ¨æœ‰4ç§ä¸åŒçš„èƒŒæ™¯éŸ³ä¹ç±»å‹ï¼š
            <ul>
                <li>ç»å…¸å’Œå¼¦è¿›è¡Œ (Classic)</li>
                <li>äº”å£°éŸ³é˜¶æ—‹å¾‹ (Pentatonic)</li>
                <li>ç¶éŸ³æ¨¡å¼ (Arpeggio)</li>
                <li>ç¯å¢ƒéŸ³å« (Ambient)</li>
            </ul>
        </div>
    </div>
    
    <div class="test-section">
        <h2>3. éŸ³æ•ˆæµ‹è¯•</h2>
        <div class="controls">
            <button onclick="playKeyPress()">æŒ‰é”®éŸ³æ•ˆ</button>
            <button onclick="playKeyError()">é”™è¯¯éŸ³æ•ˆ</button>
            <button onclick="playGameStart()">å¼€å§‹éŸ³æ•ˆ</button>
            <button onclick="playGameEnd()">ç»“æŸéŸ³æ•ˆ</button>
            <button onclick="playAchievement()">æˆå°±éŸ³æ•ˆ</button>
        </div>
        <div id="effectsStatus" class="status">ç‚¹å‡»æŒ‰é’®æµ‹è¯•å„ç§éŸ³æ•ˆ</div>
    </div>
    
    <div class="test-section">
        <h2>4. æ¸¸æˆæš‚åœ/ç»§ç»­æµ‹è¯•</h2>
        <div class="controls">
            <button onclick="simulateGameStart()">æ¨¡æ‹Ÿæ¸¸æˆå¼€å§‹</button>
            <button onclick="simulateGamePause()" id="pauseBtn" disabled>æ¨¡æ‹Ÿæš‚åœ</button>
            <button onclick="simulateGameStop()" id="stopBtn" disabled>æ¨¡æ‹Ÿåœæ­¢</button>
        </div>
        <div id="gameStatus" class="status">æ¸¸æˆçŠ¶æ€: æœªå¼€å§‹</div>
        <div class="warning">
            âš ï¸ æµ‹è¯•è¦ç‚¹ï¼š
            <ul>
                <li>æ¸¸æˆå¼€å§‹æ—¶åº”è¯¥æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆå¦‚æœéŸ³ä¹å¼€å…³å¼€å¯ï¼‰</li>
                <li>æš‚åœæ—¶åº”è¯¥åœæ­¢èƒŒæ™¯éŸ³ä¹</li>
                <li>ç»§ç»­æ—¶åº”è¯¥æ¢å¤èƒŒæ™¯éŸ³ä¹ï¼ˆå¦‚æœéŸ³ä¹å¼€å…³å¼€å¯ï¼‰</li>
                <li>åœæ­¢æ—¶åº”è¯¥åœæ­¢æ‰€æœ‰éŸ³é¢‘</li>
            </ul>
        </div>
    </div>
    
    <div class="test-section">
        <h2>5. è®¾ç½®åŒæ­¥æµ‹è¯•</h2>
        <div class="controls">
            <button onclick="saveTestSettings()">ä¿å­˜æµ‹è¯•è®¾ç½®</button>
            <button onclick="loadTestSettings()">åŠ è½½è®¾ç½®</button>
            <button onclick="clearTestSettings()">æ¸…é™¤è®¾ç½®</button>
        </div>
        <div id="settingsStatus" class="status">è®¾ç½®çŠ¶æ€: æœªæµ‹è¯•</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸš€ å¯åŠ¨å®Œæ•´æ¸¸æˆ</h2>
        <p>å¦‚æœä¸Šè¿°æµ‹è¯•éƒ½æ­£å¸¸ï¼Œå¯ä»¥å¯åŠ¨å®Œæ•´æ¸¸æˆè¿›è¡Œä½“éªŒï¼š</p>
        <div class="controls">
            <button onclick="window.location.href='index.html'">å¯åŠ¨æ¸¸æˆ</button>
            <button onclick="window.location.href='test_fixes.html'">å…¶ä»–ä¿®å¤æµ‹è¯•</button>
        </div>
    </div>

    <script>
        let gameSimulationState = {
            isPlaying: false,
            isPaused: false
        };
        
        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (window.audioManager) {
                    console.log('âœ… éŸ³é¢‘ç®¡ç†å™¨å·²åŠ è½½');
                    checkAudioStatus();
                } else {
                    console.log('âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåŠ è½½');
                    document.getElementById('audioStatus').innerHTML = 
                        '<span class="error">âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåŠ è½½ï¼Œè¯·åœ¨ä¸»æ¸¸æˆé¡µé¢æµ‹è¯•</span>';
                }
            }, 1000);
        });
        
        // æ£€æŸ¥éŸ³é¢‘çŠ¶æ€
        function checkAudioStatus() {
            if (!window.audioManager) {
                document.getElementById('audioStatus').innerHTML = 
                    '<span class="error">âŒ éŸ³é¢‘ç®¡ç†å™¨æœªåŠ è½½</span>';
                return;
            }
            
            const status = window.audioManager.getStatus();
            document.getElementById('audioStatus').innerHTML = `
                <div class="info">ğŸµ éŸ³é¢‘çŠ¶æ€:</div>
                <ul>
                    <li>ä¸»éŸ³é¢‘å¼€å…³: <span class="${status.isEnabled ? 'success' : 'error'}">${status.isEnabled ? 'å¼€å¯' : 'å…³é—­'}</span></li>
                    <li>éŸ³ä¹å¼€å…³: <span class="${status.musicEnabled ? 'success' : 'error'}">${status.musicEnabled ? 'å¼€å¯' : 'å…³é—­'}</span></li>
                    <li>éŸ³æ•ˆå¼€å…³: <span class="${status.effectsEnabled ? 'success' : 'error'}">${status.effectsEnabled ? 'å¼€å¯' : 'å…³é—­'}</span></li>
                    <li>éŸ³ä¹æ’­æ”¾ä¸­: <span class="${status.isPlaying ? 'success' : 'info'}">${status.isPlaying ? 'æ˜¯' : 'å¦'}</span></li>
                    <li>éŸ³ä¹éŸ³é‡: ${Math.round(status.musicVolume * 100)}%</li>
                    <li>éŸ³æ•ˆéŸ³é‡: ${Math.round(status.effectsVolume * 100)}%</li>
                </ul>
            `;
        }
        
        // åˆ‡æ¢ä¸»éŸ³é¢‘
        function toggleMainAudio() {
            if (window.audioManager) {
                window.audioManager.toggleAudio();
                setTimeout(checkAudioStatus, 100);
            }
        }
        
        // åˆ‡æ¢éŸ³ä¹
        function toggleMusic() {
            if (window.audioManager) {
                window.audioManager.toggleMusic();
                setTimeout(checkAudioStatus, 100);
            }
        }
        
        // åˆ‡æ¢éŸ³æ•ˆ
        function toggleEffects() {
            if (window.audioManager) {
                window.audioManager.toggleEffects();
                setTimeout(checkAudioStatus, 100);
            }
        }
        
        // å¼€å§‹éŸ³ä¹
        function startMusic() {
            if (window.audioManager) {
                window.audioManager.startBackgroundMusic();
                document.getElementById('musicStatus').innerHTML = 
                    '<span class="success">ğŸµ éŸ³ä¹å·²å¼€å§‹æ’­æ”¾</span>';
                setTimeout(checkAudioStatus, 100);
            }
        }
        
        // åœæ­¢éŸ³ä¹
        function stopMusic() {
            if (window.audioManager) {
                window.audioManager.stopBackgroundMusic();
                document.getElementById('musicStatus').innerHTML = 
                    '<span class="info">â¹ï¸ éŸ³ä¹å·²åœæ­¢</span>';
                setTimeout(checkAudioStatus, 100);
            }
        }
        
        // æµ‹è¯•ä¸åŒéŸ³ä¹ç±»å‹
        function testMusicTypes() {
            if (!window.audioManager) return;
            
            let count = 0;
            const testNext = () => {
                if (count < 4) {
                    window.audioManager.stopBackgroundMusic();
                    setTimeout(() => {
                        window.audioManager.startBackgroundMusic();
                        count++;
                        document.getElementById('musicStatus').innerHTML = 
                            `<span class="info">ğŸµ æ­£åœ¨æµ‹è¯•éŸ³ä¹ç±»å‹ ${count}/4</span>`;
                        setTimeout(testNext, 3000);
                    }, 500);
                } else {
                    document.getElementById('musicStatus').innerHTML = 
                        '<span class="success">âœ… éŸ³ä¹ç±»å‹æµ‹è¯•å®Œæˆ</span>';
                }
            };
            testNext();
        }
        
        // éŸ³æ•ˆæµ‹è¯•å‡½æ•°
        function playKeyPress() {
            if (window.audioManager) {
                window.audioManager.playSound('keyPress');
                document.getElementById('effectsStatus').innerHTML = 
                    '<span class="success">ğŸ”Š æ’­æ”¾æŒ‰é”®éŸ³æ•ˆ</span>';
            }
        }
        
        function playKeyError() {
            if (window.audioManager) {
                window.audioManager.playSound('keyError');
                document.getElementById('effectsStatus').innerHTML = 
                    '<span class="error">ğŸ”Š æ’­æ”¾é”™è¯¯éŸ³æ•ˆ</span>';
            }
        }
        
        function playGameStart() {
            if (window.audioManager) {
                window.audioManager.playSound('gameStart');
                document.getElementById('effectsStatus').innerHTML = 
                    '<span class="success">ğŸ”Š æ’­æ”¾å¼€å§‹éŸ³æ•ˆ</span>';
            }
        }
        
        function playGameEnd() {
            if (window.audioManager) {
                window.audioManager.playSound('gameEnd');
                document.getElementById('effectsStatus').innerHTML = 
                    '<span class="info">ğŸ”Š æ’­æ”¾ç»“æŸéŸ³æ•ˆ</span>';
            }
        }
        
        function playAchievement() {
            if (window.audioManager) {
                window.audioManager.playSound('achievement');
                document.getElementById('effectsStatus').innerHTML = 
                    '<span class="success">ğŸ”Š æ’­æ”¾æˆå°±éŸ³æ•ˆ</span>';
            }
        }
        
        // æ¸¸æˆæ¨¡æ‹Ÿå‡½æ•°
        function simulateGameStart() {
            gameSimulationState.isPlaying = true;
            gameSimulationState.isPaused = false;
            
            if (window.audioManager) {
                const status = window.audioManager.getStatus();
                if (status.isEnabled && status.musicEnabled) {
                    window.audioManager.startBackgroundMusic();
                }
                window.audioManager.playSound('gameStart');
            }
            
            document.getElementById('gameStatus').innerHTML = 
                '<span class="success">ğŸ® æ¸¸æˆå·²å¼€å§‹</span>';
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('stopBtn').disabled = false;
        }
        
        function simulateGamePause() {
            if (!gameSimulationState.isPlaying) return;
            
            gameSimulationState.isPaused = !gameSimulationState.isPaused;
            
            if (gameSimulationState.isPaused) {
                if (window.audioManager) {
                    window.audioManager.stopBackgroundMusic();
                }
                document.getElementById('gameStatus').innerHTML = 
                    '<span class="warning">â¸ï¸ æ¸¸æˆå·²æš‚åœ</span>';
                document.getElementById('pauseBtn').textContent = 'æ¨¡æ‹Ÿç»§ç»­';
            } else {
                if (window.audioManager) {
                    const status = window.audioManager.getStatus();
                    if (status.isEnabled && status.musicEnabled) {
                        window.audioManager.startBackgroundMusic();
                    }
                }
                document.getElementById('gameStatus').innerHTML = 
                    '<span class="success">â–¶ï¸ æ¸¸æˆå·²ç»§ç»­</span>';
                document.getElementById('pauseBtn').textContent = 'æ¨¡æ‹Ÿæš‚åœ';
            }
        }
        
        function simulateGameStop() {
            gameSimulationState.isPlaying = false;
            gameSimulationState.isPaused = false;
            
            if (window.audioManager) {
                window.audioManager.stopBackgroundMusic();
                window.audioManager.playSound('gameEnd');
            }
            
            document.getElementById('gameStatus').innerHTML = 
                '<span class="info">â¹ï¸ æ¸¸æˆå·²åœæ­¢</span>';
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('pauseBtn').textContent = 'æ¨¡æ‹Ÿæš‚åœ';
        }
        
        // è®¾ç½®æµ‹è¯•å‡½æ•°
        function saveTestSettings() {
            const testSettings = {
                enableMusic: false,
                enableSounds: true,
                theme: 'dark'
            };
            
            localStorage.setItem('gameSettings', JSON.stringify(testSettings));
            document.getElementById('settingsStatus').innerHTML = 
                '<span class="success">âœ… æµ‹è¯•è®¾ç½®å·²ä¿å­˜ (éŸ³ä¹å…³é—­, éŸ³æ•ˆå¼€å¯)</span>';
        }
        
        function loadTestSettings() {
            const settings = JSON.parse(localStorage.getItem('gameSettings') || '{}');
            document.getElementById('settingsStatus').innerHTML = 
                `<span class="info">ğŸ“‹ å½“å‰è®¾ç½®: ${JSON.stringify(settings, null, 2)}</span>`;
        }
        
        function clearTestSettings() {
            localStorage.removeItem('gameSettings');
            document.getElementById('settingsStatus').innerHTML = 
                '<span class="warning">ğŸ—‘ï¸ è®¾ç½®å·²æ¸…é™¤</span>';
        }
    </script>
</body>
</html>
